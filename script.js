document.addEventListener("DOMContentLoaded",()=>{const input=document.getElementById("input");const result=document.getElementById("result");const button=document.getElementById("btn");let shortUrl=null;button.addEventListener("click",async()=>{if(!shortUrl){const longUrl=input.value.trim();if(!longUrl)return;try{button.textContent="Converting...";const response=await fetch("https://tinyurl.com/api-create.php?url="+encodeURIComponent(longUrl));shortUrl=await response.text();result.innerHTML=`<a href="${shortUrl}" target="_blank">${shortUrl}</a>`;button.textContent="Copy"}catch(e){result.textContent="Error";button.textContent="Convert"}}else{try{await navigator.clipboard.writeText(shortUrl);button.textContent="Copied!";setTimeout(()=>{button.textContent="Copy"},1000)}catch{alert("Copy failed")}}});input.addEventListener("input",()=>{shortUrl=null;result.textContent="";button.textContent="Convert"})})